<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Pigeons</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js"></script>
    <style>
        /* Ваши стили здесь */
    </style>
</head>
<body>
    <div id="header">...</div> <!-- Элемент для отображения имени пользователя -->
    <button id="generate-button">Сгенерировать код</button>
    <div id="code"></div>
    <input type="text" id="input-code" placeholder="Введите код">
    <button id="submit-button">Отправить код</button>

    <script>
        // Инициализация Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAWwSObNeCTqDk8xJg9sa0u4wIvk5JFw8E",
            authDomain: "placeofpigeons.firebaseapp.com",
            projectId: "placeofpigeons",
            storageBucket: "placeofpigeons.appspot.com",
            messagingSenderId: "67354529384",
            appId: "1:67354529384:web:716cf99397eb9002c435dd",
            measurementId: "G-P70KRENL94"
        };
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Готовим Telegram Web App
        window.Telegram.WebApp.ready();

        // Получаем данные пользователя из Telegram
        const user = Telegram.WebApp.initDataUnsafe.user;
        console.log('Данные пользователя:', user); // Для отладки

        // Отображение имени пользователя
        let displayName = user.username || user.first_name || "Неизвестный пользователь";
        document.getElementById("header").textContent = `Привет, ${displayName}!`;

        // Генерация кода
        document.getElementById('generate-button').addEventListener('click', () => {
            const inviteCode = Math.random().toString(36).substr(2, 6);
            document.getElementById('code').textContent = `Ваш код: ${inviteCode}`;
            // Сохраняем код в Firebase
            saveCode(user.id, inviteCode);
        });

        // Функция для сохранения кода в Firebase
        function saveCode(userId, code) {
            database.ref('users/' + userId).set({
                code: code,
                name: user.first_name // или username
            }).then(() => {
                console.log('Данные успешно сохранены!');
            }).catch((error) => {
                console.error('Ошибка сохранения данных:', error);
            });
        }

        // Обработчик отправки кода
        document.getElementById('submit-button').addEventListener('click', () => {
            const inputCode = document.getElementById('input-code').value;
            // Логика для проверки кода
            getCode(inputCode);
        });

        // Функция для получения кода из Firebase
        function getCode(code) {
            database.ref('users/').orderByChild('code').equalTo(code).once('value').then((snapshot) => {
                if (snapshot.exists()) {
                    const userData = snapshot.val();
                    const userId = Object.keys(userData)[0]; // Получаем ID пользователя
                    console.log('Имя пользователя:', userData[userId].name);
                } else {
                    console.log('Код не найден');
                }
            }).catch((error) => {
                console.error('Ошибка получения данных:', error);
            });
        }
    </script>
</body>
</html>
